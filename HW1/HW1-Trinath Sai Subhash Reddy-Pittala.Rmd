---
title: "HW1-Trinath Sai Subhash Reddy-Pittala"
author: "Subhash"
date: "`r Sys.Date()`"
output:
  pdf_document:
    keep_tex: yes
  html_document:
    code_folding: hide
    word_wrap: true
---

```{r setup, include=TRUE}
library(formatR)
library(tidyverse)
library(GGally)
library(ggfortify)
library(nycflights13)
library(modelr)
library(magick)
library(haven)
library(dplyr)
library(ISLR)
library(lubridate)
library(ggplot2)
knitr::opts_chunk$set(width = 60, warning = FALSE, message = FALSE, tidy.opts=list(width.cutoff=60),tidy=TRUE, echo = TRUE)
#knitr::opts_chunk$set(echo = TRUE)

```

# R Working Environment
Please load all the packages used in the following R chunk before the function sessionInfo(). This is done using the library() function. e.g., library(tidyverse)

```{r}
sessionInfo()
```

# Working with data

1. The data set rnf6080.dat records hourly rainfall at a certain location in Canada, every day from 1960 to 1980.

a. Load the data set into R and make it a data frame called rain.df. What command did you use?

```{r}
rain.df <- read.table("rnf6080.dat")
head(rain.df)
```

b. How many rows and columns does rain.df have? How do you know? (If there are not 5070 rows and
27 columns, you did something wrong in the first part of the problem.)

```{r}
nrow(rain.df)
ncol(rain.df)
```

c. What command would you use to get the names of the columns of rain.df? What are those names?

```{r}
colnames(rain.df)
```

d. What command would you use to get the value at row 2, column 4? What is the value?

```{r}
rain.df[2,4]
```

e. What command would you use to display the whole second row? What is the content of that row?

```{r}
rain.df[2,]
```

f. What does the following command do?

```{r}
names(rain.df) <- c("year","month","day",seq(0,23))
```

  It renames column names to Year Month Day and 0 to 23 for the rest.

g. Create a new column called daily, which is the sum of the 24 hourly columns.

```{r}
rain.df <- mutate(rain.df, daily = `0` + `1` + `2` + `3` + `4` + `5` + `6` + `7` + `8` + `9` + `10` + `11` + `12` + `13` + `14` + `15` + `16` + `17` + `18` + `19` + `20` + `21` + `22` + `23`)
```

h. Give the command you would use to create a histogram of the daily rainfall amounts. Please make sure to attach your figures in your .pdf report.

```{r}
hist(rain.df$daily)
```

i. Explain why that histogram above cannot possibly be right. 

  It is not correct because rainfall cant be negative. This is occuring due to NA being replaced as -999 in data. 

j. Give the command you would use to fix the data frame.

```{r}
rain.df[rain.df == -999] <- NA
rain.df$daily <- c(rowSums(rain.df[,4:27],na.rm=TRUE))
```

k. Create a corrected histogram and again include it as part of your submitted report. Explain why it is more reasonable than the previous histogram.

```{r}
hist(rain.df$daily)
```

  This is more reasonable graph because it is showing the right skewed normal distribution without any obvious abnormalities like negative rainfall.

# Data types

2. Make sure your answers to different parts of this problem are compatible with each other.

a. For each of the following commands, either explain why they should be errors, or explain the non- erroneous result.

```{r, eval=FALSE}
x <- c("5","12","7")
    max(x)
    sort(x)
    sum(x)
```

  There are errors, because we are intializing the numbers to be character strings.
  
  max(x) finds max in numeric vector. On character vector it returns character with highest index.
  
  sort(x) sort in lexograpical order in character vector. So result would be {"12", "5", "7"}
  
  sum(x) will throw error because of invalid type of argument.
  
b. For the next two commands, either explain their results, or why they should produce errors.

```{r, eval=FALSE}
y <- c("5",7,12)
    y[2] + y[3]
```

  We are creating a vector y with three elements, where the first element is a character string, and rest numeric.
  
  y[2] + y[3] will throw an error since y[1] is character string.
  
c. For the next two commands, either explain their results, or why they should produce errors.

```{r}
z <- data.frame(z1="5",z2=7,z3=12)
    z[1,2] + z[1,3]
```

  We are creating a data frame z with three columns and one row. The first column is a character string, and rest numeric.
  
  z[1,2] + z[1,3] result 19, unlike above case in this case each vector is taken column wise so errors pop up.

# Linear algebra

3. Consider the linear system AX = b. Please answer the following questions

a. Write an R function called my_solver() such that given inputs A and b, the function my_solver() returns the solution of the linear system

```{r}
my_solver <- function(A, b) {
  X <- solve(A, b)
  return(X)
}
```

b. Run the following code to get A and b.

```{r}
n <- 100
set.seed(123)
A <- rWishart(1, 150, diag(n))[ , ,1]
b <- rnorm(n,1)
X <- my_solver(A,b)
```

Verifying

```{r}
AX = A %*% X
AX <- as.numeric(AX)
all.equal(AX, b, tolerance=0.000001)
```

# Working with ggplot2

4. EPA monitors Air Quality data across the entire U.S. The file "AQSdata.csv” contains daily PM 2.5 concentrations and other information. Please make the following questions using the ggplot() function for plotting. In addition make sure that all the x-axis and y-axis labels have 14 font size.

a. Read the data file “AQSdata.csv” into R.

```{r, echo=FALSE}
AQSdata <- read.csv("AQSdata.csv")
colnames(AQSdata)[3] <- "SiteID"
colnames(AQSdata)[5] <- "PM2.5"
```

b. Generate density plots of PM2.5 concentrations grouped by County in one single panel, where each density should have its own color. What do you find from the figure?

```{r}
ggplot(AQSdata, aes(x = PM2.5, fill = COUNTY)) + 
  geom_density(alpha = 0.5) + 
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

```

c. Plot histograms of PM2.5 concentrations across different counties with one panel for one histogram.

```{r}
ggplot(AQSdata, aes(x = PM2.5, fill = COUNTY)) + 
  geom_histogram(alpha = 0.5) + 
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14)) +
  facet_wrap(~COUNTY_CODE, ncol=2)

```

d. Generate boxplots of PM2.5 concentrations by County. What would you say about the distributions?

```{r}
# Fill = COUNTY for Legend
ggplot(AQSdata, aes(x = PM2.5, y = COUNTY)) + 
  geom_boxplot() + 
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

```

e. Reorder the boxplots above by the median value of PM2.5 concentrations.

```{r}
aqs_data_median <- aggregate(PM2.5 ~ COUNTY, data=AQSdata, median)
aqs_data_median$County <- reorder(aqs_data_median$COUNTY, aqs_data_median$PM2.5)

ggplot(AQSdata, aes(x=reorder(COUNTY, PM2.5), y=PM2.5)) +
  geom_boxplot() +
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14)) +
  coord_flip()
```

f. Converting the Site ID to a factor and plot the histogram grouped by Site ID.

```{r}
ggplot(AQSdata, aes(x=SiteID, color=as.factor(SiteID), fill=as.factor(SiteID))) + 
  geom_histogram() +
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))

```

g. Generate the time series plot for the monitoring Site ID 450190048.

```{r}
AQSdata_site <- AQSdata[AQSdata$SiteID == "450190048",]
ggplot(AQSdata_site, aes(x=as.Date(Date,"%m/%d/%y"),y=PM2.5)) + 
  geom_line() +
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14)) +
  xlab("Date")
```

h. Plot time series of PM2.5 concentrations for all monitoring sites in one panel, where each site has its own color

```{r}
ggplot(AQSdata, aes(x = as.Date(Date,"%m/%d/%y"), y = PM2.5, color = SiteID)) + 
  geom_line() + 
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14)) +
  xlab("Date")

```

i. Plot time series of PM2.5 concentrations across all monitoring sites in multiple panels, where one panel only has one site, and each row only has two panels.

```{r, fig.height=5}
ggplot(AQSdata, aes(x = as.Date(Date,"%m/%d/%y"), y = PM2.5, color = SiteID)) +
  geom_line() +
  theme(text=element_text(size=14)) +
  xlab("Date") +
  ylab("PM2.5 Concentration") +
  facet_wrap(~SiteID, ncol=2)

```

j. In the time series plot, there seems to be not enough space to hold the x-axis labels. One way to avoid this is to rotate the axis labels. Please rotate all the time labels 45 degree.

```{r, fig.height=5}
ggplot(AQSdata, aes(x = as.Date(Date,"%m/%d/%y"), y = PM2.5, color = SiteID)) +
  geom_line() +
  theme(text=element_text(size=14)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(axis.text.y = element_text(angle = 45, hjust = 1)) +
  xlab("Date") +
  ylab("PM2.5 Concentration") +
  facet_wrap(~SiteID, ncol=2)
```

# Working with dplyr

5. Continuing working with the above PM 2.5 data.

a. Filter all the observations in the county Greenville. How many observations are there?

```{r}
greenville_data <- AQSdata %>%
  filter(COUNTY == "Greenville")

nrow(greenville_data)

```

b. Filter all the observations in Greenville in August 2021

```{r}

#Convert date to date format
AQSdata$Date <- mdy(AQSdata$Date)

#Filter all the observations in Greenville in August 2021
greenville_aug_2021 <- AQSdata %>% 
  filter(COUNTY == "Greenville") %>%
  filter(month(Date) == 8 & year(Date) == 2021)

#Check number of observations
nrow(greenville_aug_2021)


```

c. Filter all the observations in Greenville in August 2021 and select the variables PM2.5 concentrations, Date, latitude and longitude of sites

```{r}
greenville_aug_2021_vars <- greenville_aug_2021 %>%
  select(Date, PM2.5, SITE_LATITUDE, SITE_LONGITUDE)
head(greenville_aug_2021_vars)
```

d. Generate scatter plot of PM2.5 against latitude and longitude in two different panels

```{r}
ggplot(AQSdata, aes(x=SITE_LATITUDE, y=PM2.5)) +
  geom_point() +
  theme(text=element_text(size=14)) +
  xlab("Latitude") +
  ylab("PM2.5 Concentration") +
  coord_flip()

ggplot(AQSdata, aes(x=SITE_LONGITUDE, y=PM2.5)) +
  geom_point() +
  theme(text=element_text(size=14)) +
  xlab("Longitude") +
  ylab("PM2.5") +
  coord_flip()
```

# About Assignment

6.

a. What is the point of reproducible code?

  The point of reproducible code is to make our life easier. Suppose having a certain set of libraries and formatting types in .rmd file helps a lot compared to selecting those every single time.

b. Given an example of why making your code reproducible is important for you to know in this class and moving forward.

  As explained in former question, reproducibility helps save time by helping us focus on data rather than worrying about whether a similar dataset is loaded correctly or not.

c. On a scale of 1 (easy) – 10 (hard), how hard was this assignment. If this assignment was hard (> 5), please state in one sentence what you struggled with.

  7
  
```{r, eval=FALSE}
  rain.df <- mutate(rain.df, daily = `0` + `1` + `2` + `3` + `4` + `5` + `6` + `7` + `8` + `9` + `10` + `11` + `12` + `13` + `14` + `15` + `16` + `17` + `18` + `19` + `20` + `21` + `22` + `23`)
```

  To find out about how to give numeric column names to a function like above took me about 1 hour of Googling and Stackoverflow.
